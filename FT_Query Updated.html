<!DOCTYPE html>
<html>
<head>
	<meta name="viewport"></meta>
	<title>ToH_2016_Reults - Google Fusion Tables</title>
	<style type="text/css">
		html {height: 100%}
		body {height: 97.5%;
			margin: 2.5%}
		#googft-mapCanvas {height: 100%}
		#layers {
			border: 1px solid #000088;
			background-color: #e0e0e0;
			width: 100%;
			margin-top: 1px;
		}
	</style>

	<script type="text/javascript" src="https://maps.google.com/maps/api/js?v=3"></script>

	<script type="text/javascript">
        var map;
        var kmlLayer = null;
        var riderLayer = null;
        var queryLayer = null;
        var currentLayer = null;
        var center = new google.maps.LatLng(39.828200, -98.579500);

		var lowNum;
		var query1;
		var query2;

        function initialize() {
            var mapDiv = document.getElementById('googft-mapCanvas');
            map = new google.maps.Map(mapDiv, {
                center: center,
                zoom: 5,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            });

            queryLayer = new google.maps.FusionTablesLayer({
                map: map,
                heatmap: { enabled: false },
                query: {
                    select: "Flag",
                    from: "1wEi1klGCHS_9RxFmIrxgcWqZO4jYCv8SSGxxUGre",
                    where: ""
                },
                options: {
                    styleId: 2,
                    templateId: 2
                }
            });
			currentLayer = queryLayer;
        }

        function passVar1() {
            lowNum = document.getElementById("lowNum").value;
            highNum = document.getElementById("highNum").value;
            query1 = "col7 >= " + lowNum + " and " + "col7 <= " + highNum;
            queryLayer.setOptions({
                query: {
                    select: "Flag",
                    from: "1wEi1klGCHS_9RxFmIrxgcWqZO4jYCv8SSGxxUGre",
                    where: query1
                }
            });
        }

        function passVar2() {
            flagNum = document.getElementById("flagNum").value;
            query2 = "Flag = " + flagNum;
            riderLayer.setOptions({
                query: {
                    select: "Flag",
                    from: "1sIH9DhpWJqagN5UkKqBUfUz3MTezl_acw4luDSPJ",
                    where: query2
                }
            });
        }

        function reset1(){
            queryLayer.setOptions({
                query: {
                    select: "Flag",
                    from: "1wEi1klGCHS_9RxFmIrxgcWqZO4jYCv8SSGxxUGre"
                }
		})}

        function reset2(){
            riderLayer.setOptions({
                query: {
                    select: "Flag",
                    from: "1sIH9DhpWJqagN5UkKqBUfUz3MTezl_acw4luDSPJ"
                }
            })}

        function riderF() {
            map.setCenter(center);
            map.setZoom(5);
            clearLayer();
            riderLayer = new google.maps.FusionTablesLayer({
                map: map,
                heatmap: { enabled: false },
                query: {
                    select: "Flag",
                    from: "1sIH9DhpWJqagN5UkKqBUfUz3MTezl_acw4luDSPJ",
                    where: ""
                },
                options: {
                    styleId: 2,
                    templateId: 2
                }
            });
            riderLayer.setMap(map);
            currentLayer = riderLayer;
        }

        function queryF() {
            map.setCenter(center);
            map.setZoom(5);
            clearLayer();
            queryLayer.setMap(map);
            currentLayer = queryLayer;
        }

        function kmlF() {
            url = document.getElementById("kmlUrl").value;
            clearLayer();
            kmlLayer = new google.maps.KmlLayer(url, {
                map: map,
                preserveViewport: true
            });
            currentLayer = kmlLayer;
        }

        function clearLayer() {
            if (currentLayer != null) {
                currentLayer.setMap(null);
            }
        }

        google.maps.event.addDomListener(window, 'load', initialize);
	</script>
</head>

<body>
	<input type="text" id="lowNum" placeholder ="Enter lower visits number" value = "">
	<input type="text" id="highNum" placeholder ="Enter higher visits number" value = "">
	<button onclick="passVar1()">Query Rider</button>
	<button onclick="reset1()">Reset</button>
	<input type="text" id="flagNum" placeholder ="Enter flag number of the rider" value = "">
	<button onclick="passVar2()">Find Rider</button>
	<button onclick="reset2()">Clear</button>
	<div id="googft-mapCanvas"></div>
	<div id="layers">
		<div id="heading"><b>GIS Layers</b></div>
		<table>
			<tr>
				<td><input onclick="riderF()" type="radio" name = "layer" id="trButton" value="rider"/></td>
				<td align="left">rider</td>
			</tr>
			<tr>
				<td><input checked onclick="queryF()" type="radio" name="layer" id="bcButton" value="query"/></td>
				<td align="left">query</td>
			</tr>
			<tr>
				<td><input onclick="kmlF()" type="radio" name="layer" id="kmlButton" value="kml"/></td>
				<td align="left">KML:
					<input type="text" size="100" id="kmlUrl" value="https://raw.githubusercontent.com/hzxsoytc/Web-Mapping-Final/master/GeoData/2016%20ToH%20Memorial%20by%20State.kml" />
				</td>
			</tr>
		</table>
	</div>
</body>
</html>